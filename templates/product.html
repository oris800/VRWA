<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ product.name }}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <div class="page-wrapper"
         data-is-admin="{{ is_admin_session | tojson }}"
         data-delete-url="{{ url_for('admin_delete_comment') }}">

        <a href="/cart">Shopping Cart</a>

        <div class="product-container">
            <div class="product-image">
                <img src="{{ product.img }}" alt="Image of {{ product.name }}">
            </div>

            <div class="product-details">
                <h1 class="product-title">{{ product.name }}</h1>
                <p class="product-price">${{ "%.2f"|format(product.price) }}</p>
                <p class="product-release-date">Release Date: {{ product.release_year }}</p>
                <p class="product-description">{{ product.description or "No description is available for this product." }}</p>

                <form id="stockForm" method="POST" data-post-url="{{ url_for('product', id=product.id) }}">
                    <input type="hidden" name="stockapi" value="http://127.0.0.1:8200/chackstock?item_id={{ product.id }}">
                    <button type="submit" id="cartButton" class="add-to-cart-btn">Add to Cart</button>
                </form>

                <div id="responseMessage"></div>
            </div>
        </div>

        <hr>

        <div class="comments-section">
            <h2>Comments</h2>
            <div class="comments-list">
                {% for comment in comments %}
                <div class="comment">
                    <p><strong>{{ comment.username }}:</strong> {{ comment.comment_text }}</p>

                    {% if is_admin_session %}
                        <button class="admin-delete-btn" data-comment-id="{{ comment.id }}">Delete (Admin)</button>
                    {% elif comment.username == session_username %}
                        <form method="POST" action="{{ url_for('product', id=product.id) }}" class="inline-form">
                            <input type="hidden" name="delete_comment_id" value="{{ comment.id }}">
                            <button type="submit">Delete</button>
                        </form>
                    {% endif %}
                </div>
                {% else %}
                <p>No comments yet.</p>
                {% endfor %}
            </div>

            <div class="add-comment-form">
                <h3>Add a Comment</h3>
                <form method="POST" action="{{ url_for('product', id=product.id) }}">
                    <textarea name="comment_text" placeholder="Write your comment here..." rows="4" required></textarea>
                    <button type="submit" class="post-comment-btn submit-btn">Post Comment</button>
                </form>
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/product.js') }}" defer></script>
</body>
</html>